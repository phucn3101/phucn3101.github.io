<!DOCTYPE html>
<html>
<head>
    <title>Advanced Insurance Data Viewer</title>
    <style>
        :root {
            --grid-columns: 2;
        }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .filters {
            display: grid;
            grid-template-columns: repeat(var(--grid-columns), 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        input, select {
            padding: 6px;
            margin: 2px 0;
        }
        @media (max-width: 768px) {
            :root { --grid-columns: 1; }
        }
    </style>
</head>
<body>
    <h1>Insurance Data Viewer</h1>
    <input type="file" id="file-input" accept=".xlsx, .xls">
    
    <div class="filters">
        <!-- Text-based Filters -->
        <div class="filter-group">
            <label>Branch</label>
            <input type="text" id="branch" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Department</label>
            <input type="text" id="department" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Product Code</label>
            <input type="text" id="product-code" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Policy No</label>
            <input type="text" id="policy-no" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Endo No</label>
            <input type="text" id="endo-no" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Currency</label>
            <input type="text" id="currency" oninput="filterData()">
        </div>
        
        <!-- Date Filters -->
        <div class="filter-group">
            <label>Issue Date</label>
            <input type="date" id="issue-date" onchange="filterData()">
        </div>
        <div class="filter-group">
            <label>Effective Date</label>
            <input type="date" id="effective-date" onchange="filterData()">
        </div>
        <div class="filter-group">
            <label>Expire Date</label>
            <input type="date" id="expire-date" onchange="filterData()">
        </div>
        
        <!-- Numeric Filters -->
        <div class="filter-group">
            <label>Sum Insured</label>
            <input type="text" id="sum-insured" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Premium</label>
            <input type="text" id="premium" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>VAT</label>
            <input type="text" id="vat" oninput="filterData()">
        </div>
        
        <!-- Additional Filters -->
        <div class="filter-group">
            <label>Customer</label>
            <input type="text" id="customer" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Agent/Broker</label>
            <input type="text" id="agent-broker" oninput="filterData()">
        </div>
        <div class="filter-group">
            <label>Sales</label>
            <input type="text" id="sales" oninput="filterData()">
        </div>
    </div>

    <button onclick="resetFilters()">Reset All Filters</button>
    <div id="data-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let rawData = [];
        let currentData = [];

        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                rawData = XLSX.utils.sheet_to_json(firstSheet);
                currentData = [...rawData];
                renderTable(currentData);
            };
            reader.readAsArrayBuffer(file);
        });

        function renderTable(data) {
            const container = document.getElementById('data-container');
            container.innerHTML = '';
            
            const table = document.createElement('table');
            const thead = table.createTHead();
            const tbody = table.createTBody();

            // Create headers
            const headerRow = thead.insertRow();
            Object.keys(data[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });

            // Create data rows
            data.forEach(row => {
                const tr = tbody.insertRow();
                Object.values(row).forEach(value => {
                    const td = tr.insertCell();
                    td.textContent = value;
                });
            });

            container.appendChild(table);
        }

        function filterData() {
            const filters = {
                branch: document.getElementById('branch').value.toLowerCase(),
                department: document.getElementById('department').value.toLowerCase(),
                productCode: document.getElementById('product-code').value.toLowerCase(),
                policyNo: document.getElementById('policy-no').value.toLowerCase(),
                endoNo: document.getElementById('endo-no').value.toLowerCase(),
                currency: document.getElementById('currency').value.toLowerCase(),
                issueDate: document.getElementById('issue-date').value,
                effectiveDate: document.getElementById('effective-date').value,
                expireDate: document.getElementById('expire-date').value,
                sumInsured: document.getElementById('sum-insured').value.toLowerCase(),
                premium: document.getElementById('premium').value.toLowerCase(),
                vat: document.getElementById('vat').value.toLowerCase(),
                customer: document.getElementById('customer').value.toLowerCase(),
                agentBroker: document.getElementById('agent-broker').value.toLowerCase(),
                sales: document.getElementById('sales').value.toLowerCase()
            };

            currentData = rawData.filter(row => {
                return (
                    matchesText(row, 'Branch', filters.branch) &&
                    matchesText(row, 'Department', filters.department) &&
                    matchesText(row, 'Product Code', filters.productCode) &&
                    matchesText(row, 'Policy No', filters.policyNo) &&
                    matchesText(row, 'Endo No', filters.endoNo) &&
                    matchesText(row, 'Currency', filters.currency) &&
                    matchesDate(row, 'Issue date', filters.issueDate) &&
                    matchesDate(row, 'Effective date', filters.effectiveDate) &&
                    matchesDate(row, 'Expire Date', filters.expireDate) &&
                    matchesText(row, 'Sum Insured', filters.sumInsured) &&
                    matchesText(row, 'Premium', filters.premium) &&
                    matchesText(row, 'VAT', filters.vat) &&
                    matchesText(row, 'Customer', filters.customer) &&
                    matchesText(row, 'Agent/Broker', filters.agentBroker) &&
                    matchesText(row, 'Sales', filters.sales)
                );
            });

            renderTable(currentData);
        }

        function matchesText(row, field, filterValue) {
            if (!filterValue) return true;
            return String(row[field]).toLowerCase().includes(filterValue);
        }

        function matchesDate(row, field, filterValue) {
            if (!filterValue) return true;
            const cellDate = new Date(row[field]).toISOString().split('T')[0];
            return cellDate === filterValue;
        }

        function resetFilters() {
            document.querySelectorAll('input').forEach(input => input.value = '');
            currentData = [...rawData];
            renderTable(currentData);
        }
    </script>
</body>
</html>
